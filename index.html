<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>I Wanna Be Yours — fragmento</title>
<style>
  html, body { height: 100%; }
  body{
    margin:0;
    background: radial-gradient(1200px 800px at 50% 30%, #3c2348 0%, #2a1833 50%, #1b1024 100%);
    overflow:hidden;
    font-family: ui-serif, Georgia, "Times New Roman", serif;
    color:#fff;
  }

  /* Partículas */
  .particle{
    position:absolute; top:-5vh; border-radius:50%;
    background:#e14; box-shadow:0 0 10px rgba(255,70,90,.65);
    opacity:.85; animation:fall linear infinite, drift ease-in-out infinite;
  }
  @keyframes fall{ to{ transform: translateY(110vh); } }
  @keyframes drift{ 0%{margin-left:-6px} 50%{margin-left:6px} 100%{margin-left:-6px} }

  /* Cabecera */
  .ui{
    position:fixed; inset:0 0 auto 0; display:flex; gap:.75rem; align-items:center;
    padding:.75rem .9rem; background:linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,0)); z-index:20;
  }

  /* Caja de letras centrada */
  .lyrics-wrap{
    position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    z-index:15; max-width:min(800px, 88vw);
  }
  .lyrics-box{
    padding:22px 28px;
    background: rgba(255,255,255,.92);
    color:#7a1d1d;
    border-radius:24px;
    box-shadow:0 10px 30px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.25) inset;
    font-size: clamp(18px, 3.5vw, 28px);
    line-height: 1.35;
    text-align:center;
    white-space: pre-line;
    backdrop-filter: blur(2px);
    min-width: 280px;
  }
  .caret::after{
    content:"";
    display:inline-block; width:1ch; height:1em; vertical-align:-0.2em;
    border-left:2px solid #7a1d1d; margin-left:2px; animation: blink 1s steps(1) infinite;
  }
  @keyframes blink{ 50%{opacity:0} }

  /* Overlay de inicio (necesario para móvil/WhatsApp) */
  .overlay{
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:40;
    background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,.35));
    user-select:none; -webkit-user-select:none;
  }
  .card{
    background:rgba(255,255,255,.95); color:#4a164a; border-radius:16px; padding:16px 18px; text-align:center;
    box-shadow:0 12px 30px rgba(0,0,0,.35);
  }
  .btn{
    margin-top:10px; border:0; border-radius:12px; padding:.7rem 1.1rem; background:#ff2d55; color:#fff; font-weight:800; cursor:pointer;
  }
  .hidden{ display:none; }
</style>
</head>
<body>

<div class="ui"><strong>Arctic Monkeys — I Wanna Be Yours</strong></div>

<div class="lyrics-wrap"><div id="lyricsBox" class="lyrics-box caret"></div></div>

<!-- Tu audio recortado -->
<audio id="bgm" src="arctic.mp3" preload="auto" playsinline></audio>

<!-- Overlay para iniciar (tap/click requerido) -->
<div id="gate" class="overlay">
  <div class="card">
    <div>Toque para escuchar el fragmento</div>
    <button id="playBtn" class="btn">▶ Reproducir</button>
  </div>
</div>

<script>
/* ===== Partículas ===== */
const PARTICLES = 24;
for (let i = 0; i < PARTICLES; i++) {
  const p = document.createElement('div');
  p.className = 'particle';
  p.style.left = `${Math.random()*100}vw`;
  const s = 6 + Math.random()*6;
  p.style.width = `${s}px`; p.style.height = `${s}px`;
  p.style.animationDuration = `${6 + Math.random()*6}s, ${2+Math.random()*3}s`;
  p.style.animationDelay = `${Math.random()*6}s, ${Math.random()*2}s`;
  document.body.appendChild(p);
}

/* ===== Configuración (MP3 ya recortado) ===== */
const FRAG_START = 0;       // inicio del verso
const FRAG_END   = 'auto';  // fin automático (fin del mp3)

/* Letras y tiempos (relativos a FRAG_START) */
const SEG = [
  { text: "Secrets I have held in my heart",           t0: 0.00, t1: 2.60 },
  { text: "Are harder to hide than I thought",         t0: 3.00, t1: 5.80 },
  { text: "Maybe I just wanna be yours",               t0: 6.20, t1: 9.00 },
  { text: "I wanna be yours, I wanna be yours",        t0: 9.50, t1: 12.90 },
  { text: "Wanna be yours",                            t0: 13.30, t1: 14.90 },
  { text: "Wanna be yours",                            t0: 15.60, t1: 17.20 },
  { text: "Wanna be yours",                            t0: 17.80, t1: 19.20 }
];

const audio = document.getElementById('bgm');
const gate  = document.getElementById('gate');
const btn   = document.getElementById('playBtn');
const box   = document.getElementById('lyricsBox');

let rafId=null, finished=false, fragEndAbs=0;

function segIndexAt(tRel){ for(let i=SEG.length-1;i>=0;i--) if(tRel>=SEG[i].t0) return i; return 0; }

function render(){
  if (finished) return cancelAnimationFrame(rafId);

  const tRel = Math.max(0, (audio.currentTime || 0) - FRAG_START);

  if (tRel >= (fragEndAbs - FRAG_START) - 0.01){
    box.textContent = SEG.at(-1).text;
    box.classList.remove('caret');
    try{ audio.pause(); }catch(e){}
    finished = true;
    return cancelAnimationFrame(rafId);
  }

  const i = segIndexAt(tRel);
  const seg = SEG[i];
  const span = Math.max(0.12, seg.t1 - seg.t0);
  const p = Math.max(0, Math.min(1, (tRel - seg.t0)/span));
  const chars = Math.round(seg.text.length * p);
  box.textContent = seg.text.slice(0, chars);

  rafId = requestAnimationFrame(render);
}

/* Inicio tras toque/clic (compatibilidad móvil/WhatsApp) */
async function start(){
  // Espera metadata para tener la duración
  await new Promise(res=>{
    if (isFinite(audio.duration) && audio.duration>0) return res();
    const on=()=>{ audio.removeEventListener('loadedmetadata', on); res(); };
    audio.addEventListener('loadedmetadata', on);
    setTimeout(res, 1500);
  });

  const total = (isFinite(audio.duration) && audio.duration>0) ? audio.duration : 20;
  fragEndAbs = (FRAG_END==='auto') ? total : Math.min(total, FRAG_END);

  try{ audio.currentTime = FRAG_START; }catch(_){}
  await audio.play();            // necesario en móviles/WhatsApp

  gate.classList.add('hidden');  // ocultar overlay
  box.textContent = "";
  box.classList.add('caret');

  cancelAnimationFrame(rafId);
  rafId = requestAnimationFrame(render);
}

btn.addEventListener('click', start);
gate.addEventListener('click', e => { if (e.target === gate) start(); });
</script>
</body>
</html>

